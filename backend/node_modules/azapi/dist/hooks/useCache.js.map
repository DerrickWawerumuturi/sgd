{"version":3,"sources":["../../src/hooks/useCache.js"],"names":["useCache","name","defaultValue","strategy","options","current","load","get","isExpire","createItem","set","value","metadata","next","date","Date","Object","assign","expire","prev","item","now","getTime","expiredOn"],"mappings":";;;;;;;AAAA;;;;AAEe,SAASA,QAAT,CACbC,IADa,EAEbC,YAFa,EAGb;AAACC,EAAAA,QAAD;AAAW,KAAGC;AAAd,IAAyB,EAHZ,EAIb;AACA,MAAI,CAACD,QAAL,EAAe;AACbA,IAAAA,QAAQ,GAAG,kCAAoBC,OAApB,CAAX;AACD;;AAED,MAAIC,OAAJ;;AAEA,WAASC,IAAT,GAAgB;AACdD,IAAAA,OAAO,GAAGF,QAAQ,CAACI,GAAT,CAAaN,IAAb,CAAV;;AACA,QAAI,CAACI,OAAD,IAAYG,QAAQ,CAACH,OAAD,CAAxB,EAAmC;AACjC;AACAA,MAAAA,OAAO,GAAGI,UAAU,CAACP,YAAD,EAAeE,OAAf,CAApB;AACAD,MAAAA,QAAQ,CAACO,GAAT,CAAaT,IAAb,EAAmBI,OAAnB;AACD;AACF;;AAED,WAASE,GAAT,GAAe;AACbD,IAAAA,IAAI;AACJ,WAAOD,OAAO,CAACM,KAAf;AACD;;AAED,WAASD,GAAT,CAAaC,KAAb,EAAoBC,QAApB,EAA8B;AAC5B,QAAI,OAAOD,KAAP,KAAiB,UAArB,EAAiC;AAC/BA,MAAAA,KAAK,GAAGA,KAAK,CAACN,OAAO,CAACM,KAAT,EAAgBP,OAAhB,CAAb;AACD;;AACD,UAAMS,IAAI,GAAG;AAACF,MAAAA,KAAD;AAAQG,MAAAA,IAAI,EAAE,IAAIC,IAAJ;AAAd,KAAb;;AACA,QAAIH,QAAJ,EAAc;AACZI,MAAAA,MAAM,CAACC,MAAP,CAAcJ,IAAd,EAAoBD,QAApB;AACD,KAFD,MAEO;AACLC,MAAAA,IAAI,CAACK,MAAL,GAAcb,OAAO,CAACa,MAAtB;AACD;;AAEDf,IAAAA,QAAQ,CAACO,GAAT,CAAaT,IAAb,EAAoBI,OAAO,GAAGQ,IAA9B;AACD;;AAED,SAAO,CAACN,GAAG,EAAJ,EAAQG,GAAR,EAAaH,GAAb,CAAP;AACD;;AAED,SAASE,UAAT,CAAoBP,YAApB,EAAkCE,OAAlC,EAA2Ce,IAA3C,EAAiD;AAC/C,QAAMC,IAAI,GACR,OAAOlB,YAAP,KAAwB,UAAxB,GACIA,YAAY,CAACE,OAAD,CADhB,GAEI;AAACO,IAAAA,KAAK,EAAET;AAAR,GAHN,CAD+C,CAK/C;;AACA,MAAIiB,IAAI,IAAI,CAACX,QAAQ,CAACW,IAAD,CAAjB,IAA2BA,IAAI,CAACR,KAAL,KAAeS,IAAI,CAACT,KAAnD,EAA0D;AACxD;AACD;;AACDS,EAAAA,IAAI,CAACN,IAAL,GAAY,IAAIC,IAAJ,EAAZ;AACA,SAAOK,IAAP;AACD;;AAED,SAASZ,QAAT,CAAkB;AAACU,EAAAA,MAAD;AAASJ,EAAAA;AAAT,CAAlB,EAAkC;AAChC,MAAI,CAACI,MAAL,EAAa;AACX,WAAO,KAAP;AACD;;AAED,QAAMG,GAAG,GAAG,IAAIN,IAAJ,GAAWO,OAAX,EAAZ;AACA,MAAIC,SAAJ,CANgC,CAOhC;;AACA,MAAI,OAAOL,MAAP,KAAkB,QAAtB,EAAgC;AAC9BK,IAAAA,SAAS,GACP,CAACT,IAAI,YAAYC,IAAhB,GAAuBD,IAAI,CAACQ,OAAL,EAAvB,GAAwC,IAAIP,IAAJ,CAASD,IAAT,EAAeQ,OAAf,EAAzC,IACAJ,MAFF;AAGD,GAJD,CAKA;AALA,OAMK,IAAI,EAAEA,MAAM,YAAYH,IAApB,CAAJ,EAA+B;AAClCQ,MAAAA,SAAS,GAAG,IAAIR,IAAJ,CAASG,MAAT,CAAZ;AACD,KAFI,MAEE;AACLK,MAAAA,SAAS,GAAGL,MAAZ;AACD;;AAED,SAAOK,SAAS,GAAGF,GAAnB;AACD","sourcesContent":["import MemoryCacheStrategy from '../cachingStrategies/MemoryCacheStrategy';\n\nexport default function useCache(\n  name,\n  defaultValue,\n  {strategy, ...options} = {},\n) {\n  if (!strategy) {\n    strategy = MemoryCacheStrategy(options);\n  }\n\n  let current;\n\n  function load() {\n    current = strategy.get(name);\n    if (!current || isExpire(current)) {\n      // is expired or not created yet\n      current = createItem(defaultValue, options);\n      strategy.set(name, current);\n    }\n  }\n\n  function get() {\n    load();\n    return current.value;\n  }\n\n  function set(value, metadata) {\n    if (typeof value === 'function') {\n      value = value(current.value, options);\n    }\n    const next = {value, date: new Date()};\n    if (metadata) {\n      Object.assign(next, metadata);\n    } else {\n      next.expire = current.expire;\n    }\n\n    strategy.set(name, (current = next));\n  }\n\n  return [get(), set, get];\n}\n\nfunction createItem(defaultValue, options, prev) {\n  const item =\n    typeof defaultValue === 'function'\n      ? defaultValue(options)\n      : {value: defaultValue};\n  // not change\n  if (prev && !isExpire(prev) && prev.value === item.value) {\n    return;\n  }\n  item.date = new Date();\n  return item;\n}\n\nfunction isExpire({expire, date}) {\n  if (!expire) {\n    return false;\n  }\n\n  const now = new Date().getTime();\n  let expiredOn;\n  // expire after ms\n  if (typeof expire === 'number') {\n    expiredOn =\n      (date instanceof Date ? date.getTime() : new Date(date).getTime()) +\n      expire;\n  }\n  // expired on specified date\n  else if (!(expire instanceof Date)) {\n    expiredOn = new Date(expire);\n  } else {\n    expiredOn = expire;\n  }\n\n  return expiredOn < now;\n}\n"],"file":"useCache.js"}